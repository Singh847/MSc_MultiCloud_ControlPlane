<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Multi-Cloud Control Plane</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    .top { display:flex; justify-content:space-between; align-items:center; gap: 12px; }
    .cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin: 16px 0; }
    .card { border: 1px solid #ddd; padding: 12px; border-radius: 10px; }
    table { border-collapse: collapse; width: 100%; margin-top: 12px; }
    th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
    th { background: #f5f5f5; text-align: left; }
    .imgrow { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 16px 0; }
    img { width: 100%; border: 1px solid #ddd; border-radius: 10px; }
    .muted { color:#666; font-size: 13px; }
  </style>
</head>
<body>
  <div class="top">
    <h1>Multi-Cloud Control Plane</h1>
    <div>
      <div class="muted">Providers: {{ summary.providers | join(", ") }}</div>
      <a href="/methodology">Methodology</a>
    </div>
  </div>

  <div class="cards">
    <div class="card"><b>Resources</b><br/>{{ summary.resource_count }}</div>
    <div class="card"><b>Findings</b><br/>{{ summary.finding_count }}</div>
    <div class="card"><b>Total Cost (est.)</b><br/>£{{ summary.monthly_cost_total_estimate }}</div>
    <div class="card"><b>Cost per Provider</b><br/>
      {% for k,v in summary.cost_per_provider.items() %}
        {{ k }}: £{{ v }}<br/>
      {% endfor %}
    </div>
  </div>

  <div class="imgrow">
    <div>
      <h3>Resources per Provider</h3>
      <img src="/charts/resources.png?providers={{ summary.providers | join(',') }}" />
    </div>
    <div>
      <h3>Findings by Severity</h3>
      <img src="/charts/findings.png?providers={{ summary.providers | join(',') }}" />
    </div>
  </div>

  <h2>Resources</h2>
  <table>
    <tr>
      <th>Provider</th><th>Type</th><th>Region</th><th>Name</th><th>Public</th><th>Encrypted</th><th>£/month</th>
    </tr>
    {% for r in resources %}
    <tr>
      <td>{{ r.provider }}</td>
      <td>{{ r.type }}</td>
      <td>{{ r.region }}</td>
      <td>{{ r.name }}</td>
      <td>{{ r.public }}</td>
      <td>{{ r.encrypted }}</td>
      <td>{{ r.monthly_cost_estimate }}</td>
    </tr>
    {% endfor %}
  </table>

  <h2>Policy Findings</h2>
  <table>
    <tr>
      <th>Severity</th><th>Rule</th><th>Provider</th><th>Resource</th><th>Message</th>
    </tr>
    {% for f in findings %}
    <tr>
      <td>{{ f.severity }}</td>
      <td>{{ f.rule }}</td>
      <td>{{ f.provider }}</td>
      <td>{{ f.resource_id }}</td>
      <td>{{ f.message }}</td>
    </tr>
    {% endfor %}
  </table>

</body>
</html>
